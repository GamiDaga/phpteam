<?php
    require_once('./sql/connect.php');
    require_once('./sql/query.php');
    require_once('./layout/head.php');
 ?>

<body>
    <?php
        require_once('./layout/navbar.php');
        $link = connect();
    ?>

    <div class="contenedor">

        <div class="parallax-container">
            <div class="parallax"><img src="./images/background.jpg"></div>
        </div>

        <div class="section container ">
            <h2 class="header">Peliculas</h2>
                <div class="movie-section">
                    <?php
                    //Evitamos que salgan errores por variables vacías
                    //error_reporting(E_ALL ^ E_NOTICE);
                    //Cantidad de resultados por página (debe ser INT, no string/varchar)
                    $quantity_rows_in_page = 5;
                    //Comprueba si está seteado el GET de HTTP
                    if (isset($_GET["page"])) {
                    	//Si el GET de HTTP SÍ es una string / cadena, procede
                    	if (is_string($_GET["page"])) {
                    		//Si la string es numérica, define la variable 'pagina'
                    		 if (is_numeric($_GET["page"])) {
                    			 //Si la petición desde la paginación es la página uno
                    			 //en lugar de ir a 'index.php?pagina=1' se iría directamente a 'index.php'
                    			 if ($_GET["page"] == 1) {
                    				 header("Location: index.php");
                    				 die();
                    			 }else{ //Si la petición desde la paginación no es para ir a la pagina 1, va a la que sea
                    				 $page = $_GET["page"];
                    			 };
                    		 }else{ //Si la string no es numérica, redirige al index (por ejemplo: index.php?pagina=AAA)
                    			 header("Location: index.php");
                    			die();
                    		 };
                    	};
                    } else { //Si el GET de HTTP no está seteado, lleva a la primera página (puede ser cambiado al index.php o lo que sea)
                    	$page = 1;
                    };
                    //Define el número 0 para empezar a paginar multiplicado por la cantidad de resultados por página
                    $start_from = ($page-1) * $quantity_rows_in_page;
                    ?>
                    <span>
                    <?php
                        $query = movie();
<<<<<<< HEAD
                        $result = mysqli_query($link, $query);
                        //Cuenta el número total de registros
                        $total_rows = mysqli_num_rows($result);
                        //Obtiene el total de páginas existentes
                        $quantityPages= ceil($total_rows / $quantity_rows_in_page);
                        //Realiza la consulta en el orden de ID ascendente (cambiar "id" por, por ejemplo, "nombre" o "edad", alfabéticamente, etc.)
                        //Limitada por la cantidad de cantidad por página
                        $query = pageMovies($start_from, $quantity_rows_in_page);
                        //echo '<pre>'; var_dump($query); exit();
                        $result = mysqli_query($link, $query);
                        //echo '<pre>'; var_dump($result); exit();
                        //Crea un bluce 'while' y define a la variable 'datos' ($row) como clave del array
                        //que mostrará los resultados por nombre
                        while($row = mysqli_fetch_assoc($result)) {
                                    $row = mysqli_fetch_assoc($result);
                                    echo "<span><img src='./functions/showImage.php?idMovie=".$row['id']."'></span>"
                                        ."<h3>".$row['nombre']."</h1>"
                                        ."<p>".$row['anio']."</p>"
                                        ."<p>".$row['sinopsis']."</p>";
                                        // agregar
                        };
                    ?>
                    </span>
                </div>
            </div>

            <ul class="pagination">
                <li class="disabled"><a href=""><i class="material-icons">chevron_left</i></a></li>
                <li class="active"><a href="?page=1">1</a></li>
                <?php
                    for ($i= 1; $i < $quantityPages; $i++){
                        echo "<li class='waves-effect'><a href='?page=".$i."'>".$i."</a></li>";
                    }
                ?>
            <li class="waves-effect"><a href="#!"><i class="material-icons">chevron_right</i></a></li>
        </ul>
=======
                        $result = mysqli_query($link,$query);
                        //echo "<pre>"; var_dump($result); exit();
                        while ($row = mysqli_fetch_array($result)) {
                          echo "<div class='row'>";
                          echo "<img src='../functions/showImage.php?id=".$row['id']."'>" // aca va la imagen desde el sql pero misteriosamente no funiona
                          //echo "<img src='./Carteles/el-senor-de-los-anillos-la-comunidad-del-anillo.jpg' width='300px' height='450px'>"

                          ."<h3>".$row['nombre']."</h3>"
                          ."<p>".$row['anio']."</p>"
                          ."<p>".calificacion($row[id])."</p>"
                          ."<p>".$row['sinopsis']."</p>";
                        echo "<form action='./detalle.php' method='get'>
                          <input type='hidden' name='id' value='".$row['id']."'>
                          <button  class='btn'> Ver mas</button>
                        </form>";

                         echo "</div>";
                        }
                    ?>
                    </span>
                </div>
>>>>>>> f06374b2784d6ff6cd2758fecc1a67fd6bf567d3
        </div>

    </div>


<?php require_once('./layout/footer.php'); ?>
</body>
